<!-- Chat toggle button -->
<button class="chat-toggle-button" (click)="toggleChat()">
  <i class="chat-icon" *ngIf="!isChatOpen">ðŸ’¬</i>
  <i class="close-icon" *ngIf="isChatOpen">Ã—</i>
</button>

<!-- Chat widget container -->
<div class="chatbot-container" [ngClass]="{'open': isChatOpen}">
  <div class="chatbot-header">
    <h2>How can I help you?</h2>
  </div>
  
  <div #messagesContainer class="chatbot-messages">
    <div *ngFor="let message of messages" 
         [ngClass]="{'message-container': true, 'user-message': message.sender === 'user', 'bot-message': message.sender === 'bot'}">
      <div class="message-bubble">
        <div class="message-content">{{ message.content }}</div>
        
        <!-- If there's rich content from Dialogflow, render it -->
        <div *ngIf="message.richResponse" class="rich-response">
          <!-- Handle different types of rich responses here -->
          <div *ngIf="message.richResponse.buttons" class="suggestion-buttons">
            <button *ngFor="let button of message.richResponse.buttons" 
                    class="suggestion-button" 
                    (click)="messageInput.setValue(button.text); sendMessage()">
              {{ button.text }}
            </button>
          </div>
          
          <!-- Add other rich response types as needed -->
        </div>
        
        <div class="message-timestamp">{{ message.timestamp | date:'shortTime' }}</div>
      </div>
    </div>
  </div>
  
  <!-- Show typing indicator when loading -->
  <div *ngIf="loading" class="typing-indicator">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </div>
  
  <div class="chatbot-input">
    <!-- Hidden file input -->
    <input type="file" #fileInput style="display: none" (change)="handleFileInput($event)">
    
    <!-- Attachment button -->
    <button class="icon-button attachment-button" (click)="openFileInput()">
      <i class="attachment-icon">ðŸ“Ž</i>
    </button>
    
    <!-- Voice button -->
    <button class="icon-button voice-button" 
            [ngClass]="{'recording': isRecording}"
            (click)="toggleVoiceInput()">
      <i class="mic-icon">ðŸŽ¤</i>
    </button>
    
    <!-- Text input -->
    <input type="text" 
           class="message-input"
           [formControl]="messageInput" 
           placeholder="Type your message here..." 
           (keyup.enter)="sendMessage()">
    
    <!-- Send button -->
    <button class="icon-button send-button" 
            (click)="sendMessage()" 
            [disabled]="loading || !messageInput.value?.trim()">
      <i class="send-icon">âž¤</i>
    </button>
  </div>
</div>
